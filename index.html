<html>
<head>
    <script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.2.13/dist/semantic.min.css">
  <style>
    html, body {
        margin: 10px;
    }
    textarea {
        font-family: "Courier", monotype;
        font-size: 0.9em !important;
    }
    #glyphs div.inner {
        padding: 0.5em;
        text-align: center;
    }
    #glyphs h2.inner {
        font-size: 2em;
        padding: 0.3em;
        text-align: center;
    }
    #glyphs table {
        border: 1px solid black;
        margin: auto;
    }
    #glyphs table tr {
        height: 10px;
    }
    #glyphs table td {
        border: 1px solid lightgrey;
        width: 10px;
    }
    #glyphs table td.cell.fill {
        background: black;
    }
    #glyphs table td.cell.dead {
        background: lightgrey;
    }
    .baseline {
      position:absolute;
      left:0px;
      width:100%;
      height:2px;
      background-color:#090;
      opacity:0.4;
      pointer-events: none;
    }
   </style>

</head>
<body>
    <a href="https://github.com/tchapi/Adafruit-GFX-Font-Customiser"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>

    <h1 class="ui header">Adafruit GFX Pixel font customiser</h1>
    <p><em>Created by 
		<a href="https://github.com/tchapi">tchapi</a>
		- Original source code available on 
		<a href="https://github.com/tchapi/Adafruit-GFX-Font-Customiser">Github</a>.</em>
		<br><em>Forked by 
		<a href="https://github.com/cmarrin">cmarrin</a>
		- Source code available on 
		<a href="https://github.com/cmarrin/Adafruit-GFX-Font-Customiser">Github</a>.</em>
	</p>
		 
    <div class="ui divider"></div>

    <div class="ui grid">
        <div class="eight wide column">
            <div class="ui teal segment">
                <div class="ui form">
                  <div class="field">
                    <label>Original font file <em class="fontname" style="display: none;">FontName unknown</em></label>
                    <textarea id="source">
const uint8_t Font_5x7_practical8pt7bBitmaps[] PROGMEM = {
  0xFA, 0xB6, 0x80, 0x57, 0xD5, 0xF5, 0x00, 0x23, 0xA3, 0x07, 0x06, 0x2E,
  0x20, 0xCE, 0x44, 0x44, 0x4E, 0x60, 0x64, 0xA4, 0xCA, 0xC9, 0xA0, 0xE0,
  0x6A, 0xA4, 0x95, 0x58, 0x55, 0x00, 0x21, 0x3E, 0x42, 0x00, 0xF6, 0xF8,
  0xF0, 0x25, 0x25, 0x20, 0x74, 0x63, 0x58, 0xC5, 0xC0, 0x75, 0x54, 0x74,
  0x62, 0x22, 0x23, 0xE0, 0xF8, 0x88, 0xE0, 0xC5, 0xC0, 0x12, 0x95, 0x2F,
  0x88, 0x40, 0xFC, 0x21, 0xE0, 0x87, 0xC0, 0x74, 0x61, 0x6C, 0xC5, 0xC0,
  0xF8, 0x44, 0x22, 0x10, 0x80, 0x74, 0x62, 0xE8, 0xC5, 0xC0, 0x74, 0x62,
  0xF0, 0xC5, 0xC0, 0xF0, 0xF0, 0xF0, 0xF6, 0x1B, 0x20, 0xC1, 0x80, 0xF8,
  0x3E, 0xC1, 0x82, 0x6C, 0x00, 0x74, 0x62, 0x22, 0x00, 0x80, 0x74, 0x67,
  0x59, 0xC1, 0xC0, 0x22, 0x95, 0x1F, 0xC6, 0x20, 0xF4, 0x63, 0xE8, 0xC7,
  0xC0, 0x74, 0x61, 0x08, 0x45, 0xC0, 0xF4, 0x63, 0x18, 0xC7, 0xC0, 0xFC,
  0x21, 0xE8, 0x43, 0xE0, 0xFC, 0x21, 0xE8, 0x42, 0x00, 0x74, 0x61, 0x38,
  0xC5, 0xE0, 0x8C, 0x63, 0xF8, 0xC6, 0x20, 0xFE, 0xF8, 0x43, 0x18, 0xC5,
  0xC0, 0x8C, 0x65, 0xC9, 0x46, 0x20, 0x84, 0x21, 0x08, 0x43, 0xE0, 0x8E,
  0xF7, 0x5A, 0xC6, 0x20, 0x8E, 0x73, 0x5A, 0xCE, 0x60, 0x74, 0x63, 0x18,
  0xC5, 0xC0, 0xF4, 0x63, 0xE8, 0x42, 0x00, 0x74, 0x63, 0x1A, 0xC9, 0xA0,
  0xF4, 0x63, 0xEA, 0x4A, 0x20, 0x74, 0x60, 0xE0, 0xC5, 0xC0, 0xF9, 0x08,
  0x42, 0x10, 0x80, 0x8C, 0x63, 0x18, 0xC5, 0xE0, 0x8C, 0x63, 0x15, 0x28,
  0x80, 0x8C, 0x6B, 0x5A, 0xA9, 0x40, 0x8C, 0x54, 0x45, 0x46, 0x20, 0x8C,
  0x54, 0x42, 0x10, 0x80, 0xF8, 0x44, 0x44, 0x43, 0xE0, 0xEA, 0xAC, 0x91,
  0x24, 0x48, 0xD5, 0x5C, 0x22, 0xA3, 0x10, 0xF8, 0x88, 0x80, 0x70, 0x5F,
  0x17, 0x80, 0x84, 0x2D, 0x98, 0xC7, 0xC0, 0x7C, 0x21, 0x07, 0x80, 0x08,
  0x5B, 0x38, 0xC5, 0xE0, 0x74, 0x7F, 0x07, 0x00, 0x34, 0x4F, 0x44, 0x40,
  0x6C, 0xE3, 0x17, 0x85, 0xC0, 0x84, 0x2D, 0x98, 0xC6, 0x20, 0xBE, 0x45,
  0x55, 0x80, 0x88, 0x9A, 0xCA, 0x90, 0xAA, 0xA4, 0xD5, 0x6B, 0x5A, 0x80,
  0xB6, 0x63, 0x18, 0x80, 0x74, 0x63, 0x17, 0x00, 0xB6, 0x63, 0x1F, 0x42,
  0x00, 0x6C, 0xE3, 0x17, 0x84, 0x20, 0xBC, 0x88, 0x80, 0x7C, 0x1C, 0x1F,
  0x00, 0x44, 0xF4, 0x44, 0x30, 0x8C, 0x63, 0x36, 0x80, 0x8C, 0x62, 0xA2,
  0x00, 0x8D, 0x6A, 0xA5, 0x00, 0x8A, 0x88, 0xA8, 0x80, 0x8C, 0x62, 0xA2,
  0x22, 0x00, 0xF8, 0x88, 0x8F, 0x80, 0x69, 0x44, 0x98, 0xFE, 0xC9, 0x14,
  0xB0, 0x6D, 0x80 };

const GFXglyph Font_5x7_practical8pt7bGlyphs[] PROGMEM = {
  {     0,   0,   0,   4,    0,    1 },   // 0x20 ' '
  {     0,   1,   7,   2,    0,   -6 },   // 0x21 '!'
  {     1,   3,   3,   4,    0,   -7 },   // 0x22 '"'
  {     3,   5,   5,   6,    0,   -5 },   // 0x23 '#'
  {     7,   5,   9,   6,    0,   -7 },   // 0x24 '$'
  {    13,   5,   7,   6,    0,   -6 },   // 0x25 '%'
  {    18,   5,   7,   6,    0,   -6 },   // 0x26 '&'
  {    23,   1,   3,   2,    0,   -7 },   // 0x27 '''
  {    24,   2,   7,   4,    1,   -6 },   // 0x28 '('
  {    26,   2,   7,   4,    0,   -6 },   // 0x29 ')'
  {    28,   3,   3,   5,    1,   -7 },   // 0x2A '*'
  {    30,   5,   5,   6,    0,   -5 },   // 0x2B '+'
  {    34,   2,   4,   5,    0,   -1 },   // 0x2C ','
  {    35,   5,   1,   6,    0,   -3 },   // 0x2D '-'
  {    36,   2,   2,   5,    0,   -1 },   // 0x2E '.'
  {    37,   3,   7,   5,    1,   -6 },   // 0x2F '/'
  {    40,   5,   7,   6,    0,   -6 },   // 0x30 '0'
  {    45,   2,   7,   3,    0,   -6 },   // 0x31 '1'
  {    47,   5,   7,   6,    0,   -6 },   // 0x32 '2'
  {    52,   5,   7,   6,    0,   -6 },   // 0x33 '3'
  {    57,   5,   7,   6,    0,   -6 },   // 0x34 '4'
  {    62,   5,   7,   6,    0,   -6 },   // 0x35 '5'
  {    67,   5,   7,   6,    0,   -6 },   // 0x36 '6'
  {    72,   5,   7,   6,    0,   -6 },   // 0x37 '7'
  {    77,   5,   7,   6,    0,   -6 },   // 0x38 '8'
  {    82,   5,   7,   6,    0,   -6 },   // 0x39 '9'
  {    87,   2,   6,   5,    0,   -6 },   // 0x3A ':'
  {    89,   2,   8,   5,    0,   -6 },   // 0x3B ';'
  {    91,   5,   5,   6,    0,   -5 },   // 0x3C '<'
  {    95,   5,   3,   6,    0,   -4 },   // 0x3D '='
  {    97,   5,   5,   6,    0,   -5 },   // 0x3E '>'
  {   101,   5,   7,   6,    0,   -6 },   // 0x3F '?'
  {   106,   5,   7,   6,    0,   -6 },   // 0x40 '@'
  {   111,   5,   7,   6,    0,   -6 },   // 0x41 'A'
  {   116,   5,   7,   6,    0,   -6 },   // 0x42 'B'
  {   121,   5,   7,   6,    0,   -6 },   // 0x43 'C'
  {   126,   5,   7,   6,    0,   -6 },   // 0x44 'D'
  {   131,   5,   7,   6,    0,   -6 },   // 0x45 'E'
  {   136,   5,   7,   6,    0,   -6 },   // 0x46 'F'
  {   141,   5,   7,   6,    0,   -6 },   // 0x47 'G'
  {   146,   5,   7,   6,    0,   -6 },   // 0x48 'H'
  {   151,   1,   7,   2,    0,   -6 },   // 0x49 'I'
  {   152,   5,   7,   6,    0,   -6 },   // 0x4A 'J'
  {   157,   5,   7,   6,    0,   -6 },   // 0x4B 'K'
  {   162,   5,   7,   6,    0,   -6 },   // 0x4C 'L'
  {   167,   5,   7,   6,    0,   -6 },   // 0x4D 'M'
  {   172,   5,   7,   6,    0,   -6 },   // 0x4E 'N'
  {   177,   5,   7,   6,    0,   -6 },   // 0x4F 'O'
  {   182,   5,   7,   6,    0,   -6 },   // 0x50 'P'
  {   187,   5,   7,   6,    0,   -6 },   // 0x51 'Q'
  {   192,   5,   7,   6,    0,   -6 },   // 0x52 'R'
  {   197,   5,   7,   6,    0,   -6 },   // 0x53 'S'
  {   202,   5,   7,   6,    0,   -6 },   // 0x54 'T'
  {   207,   5,   7,   6,    0,   -6 },   // 0x55 'U'
  {   212,   5,   7,   6,    0,   -6 },   // 0x56 'V'
  {   217,   5,   7,   6,    0,   -6 },   // 0x57 'W'
  {   222,   5,   7,   6,    0,   -6 },   // 0x58 'X'
  {   227,   5,   7,   6,    0,   -6 },   // 0x59 'Y'
  {   232,   5,   7,   6,    0,   -6 },   // 0x5A 'Z'
  {   237,   2,   7,   4,    1,   -6 },   // 0x5B '['
  {   239,   3,   7,   5,    1,   -6 },   // 0x5C '\'
  {   242,   2,   7,   4,    0,   -6 },   // 0x5D ']'
  {   244,   5,   4,   6,    0,   -7 },   // 0x5E '^'
  {   247,   5,   1,   6,    0,    1 },   // 0x5F '_'
  {   248,   3,   3,   5,    1,   -7 },   // 0x60 '`'
  {   250,   5,   5,   6,    0,   -4 },   // 0x61 'a'
  {   254,   5,   7,   6,    0,   -6 },   // 0x62 'b'
  {   259,   5,   5,   6,    0,   -4 },   // 0x63 'c'
  {   263,   5,   7,   6,    0,   -6 },   // 0x64 'd'
  {   268,   5,   5,   6,    0,   -4 },   // 0x65 'e'
  {   272,   4,   7,   5,    0,   -6 },   // 0x66 'f'
  {   276,   5,   7,   6,    0,   -4 },   // 0x67 'g'
  {   281,   5,   7,   6,    0,   -6 },   // 0x68 'h'
  {   286,   1,   7,   2,    0,   -6 },   // 0x69 'i'
  {   287,   2,   9,   3,    0,   -6 },   // 0x6A 'j'
  {   290,   4,   7,   5,    0,   -6 },   // 0x6B 'k'
  {   294,   2,   7,   3,    0,   -6 },   // 0x6C 'l'
  {   296,   5,   5,   6,    0,   -4 },   // 0x6D 'm'
  {   300,   5,   5,   6,    0,   -4 },   // 0x6E 'n'
  {   304,   5,   5,   6,    0,   -4 },   // 0x6F 'o'
  {   308,   5,   7,   6,    0,   -4 },   // 0x70 'p'
  {   313,   5,   7,   6,    0,   -4 },   // 0x71 'q'
  {   318,   4,   5,   5,    0,   -4 },   // 0x72 'r'
  {   321,   5,   5,   6,    0,   -4 },   // 0x73 's'
  {   325,   4,   7,   5,    0,   -6 },   // 0x74 't'
  {   329,   5,   5,   6,    0,   -4 },   // 0x75 'u'
  {   333,   5,   5,   6,    0,   -4 },   // 0x76 'v'
  {   337,   5,   5,   6,    0,   -4 },   // 0x77 'w'
  {   341,   5,   5,   6,    0,   -4 },   // 0x78 'x'
  {   345,   5,   7,   6,    0,   -4 },   // 0x79 'y'
  {   350,   5,   5,   6,    0,   -4 },   // 0x7A 'z'
  {   354,   3,   7,   6,    2,   -6 },   // 0x7B '{'
  {   357,   1,   7,   4,    1,   -6 },   // 0x7C '|'
  {   358,   3,   7,   4,    0,   -6 },   // 0x7D '}'
  {   361,   5,   2,   6,    0,   -4 } }; // 0x7E '~'

const GFXfont Font_5x7_practical8pt7b PROGMEM = {
  (uint8_t  *)Font_5x7_practical8pt7bBitmaps,
  (GFXglyph *)Font_5x7_practical8pt7bGlyphs,
  0x20, 0x7E, 10 };
                    </textarea>
                  </div>
                    <button class="ui button teal" id="extract">Extract</button>
                </div>   
            </div> 
        </div>

        <div class="eight wide column">
            <div class="ui green segment" id="resultWrapper">
                <div class="ui form">
                    <div class="field">
                        <label>Output</label>
                        <textarea id="result" readonly></textarea>
                    </div>
                    <button class="ui button green" id="export">Process and create file</button>
                </div>
            </div> 
        </div>
    </div>

    <h2 class="ui header">Separate glyphs</h2>
    <div id="glyphs" class="ui grid"><em>Please paste the content of a font file first</em></div>

</body>
<script>

function makeUpDownButton(name, func, color, width)
{
  var button = $('<div class="ui mini compact buttons" style="margin:1px"></div>');
  var style = 'ui compact button ' + func + '-handler ' + color;
  button.append('<button id="' + func + '-add" class="' + style + '">+</button>');  
  button.append('<button id="' + func + '-value" class="ui compact disabled button ' + color + '" style="width:' + width + '">' + name + '</button>');
  button.append('<button id="' + func + '-remove" class="' + style + '">-</button>');
  return button;
}

function setGlyphTable(table)
{
    var xadvance = parseInt(table.attr("data-adv"));
    var yadvance = parseInt(window["yAdvance"]);
	
    var xoffset = parseInt(table.attr("data-ow"));
    var yoffset = parseInt(table.attr("data-oh"));
	
    var width = parseInt(table.attr("data-w"));
    var height = parseInt(table.attr("data-h"));
	
	var pixels = table.attr("data-pixels");
	
    var maxBaseline = window["maxBaseline"];
	
	var left = xoffset;
	var right = width + xoffset;
	var top = maxBaseline + yoffset;
	var bottom = top + height;
    
	// Set the table
    table.empty();
    for(var i = 0; i < yadvance; i++) {
        var row = $('<tr></tr>');
        for(var j = 0; j < xadvance; j++) {
            var cell = $('<td></td>').addClass("cell");
			if (i < top || i >= bottom || j < left || j >= right) {
                cell.addClass('dead');
			} else if (pixels.charAt((i - top) * width + (j - left)) == '1') {
                cell.addClass('fill');
            }
            row.append(cell);
        }
        table.append(row);
    }
    
    // Set the baseline
    var baseline = table.parent().find('.baseline');
    baseline.css("top", ((maxBaseline + 1) * 12) + "px");
}

function updatePixels(table, newWidth, newHeight)
{
    var width = parseInt(table.attr("data-w"));
    var height = parseInt(table.attr("data-h"));
	
	if (newWidth < 0) {
		newWidth = width;
	}
	
	if (newHeight < 0) {
		newHeight = height;
	}
	
	// Extract the pixel values from the table
	var pixels = "";
    table.find("td").each(function() {
		if (!$(this).hasClass('dead')) {
			pixels += $(this).hasClass('fill') ? "1" : "0";
		}
	});
	
	// Store the pixels into a 2D bool array
	var array = [ ];
	for (var i = 0; i < height; ++i) {
		var rowArray = [ ];
		for (var j = 0; j < width; ++j) {
			rowArray.push((pixels.charAt(i * width + j) == '1') ? true : false);
		}
		array.push(rowArray);
	}
	
	// Write out to a string newWidth x newHeight
	var newPixels = "";
	for (var i = 0; i < newHeight; ++i) {
		for (var j = 0; j < newWidth; ++j) {
			if (i >= height || j >= width) {
				newPixels += "0";
			} else {
				newPixels += array[i][j] ? "1" : "0";
			}
		}
	}
	
	// Pad out to a multiple of 8
	var pad = newPixels.length % 8;
	for (var i = 0; i < pad; ++i) {
		newPixels += "0";
	}
	
    table.attr('data-pixels', newPixels);	
}

$(document).ready(function(){

    window["name"] = null;
    window["last_part"] = null;

    $('#extract').click(function() {
        var data = $("#source").val();

        // Extract name
        var re = /const\ uint8\_t\ (.*)Bitmaps\[\]/
        var found = data.match(re);

        if (found != null && found.length > 1) {
            window["name"] = found[1];

            var re_size = /([a-zA-Z\_]*)([0-9]+)pt(.*)/
            var found_size = name.match(re_size);
            window["size"] = parseInt(found_size[2]);
        } else {
            alert("No correct font file found, please paste the content of an Adafruit GFX font file first.");
            return;
        }

        $('#glyphs').empty();

        // extract GFXFont part
        var last_part_re = /const\ GFXfont([\s\S]*)/g;
        var last_part = data.match(last_part_re);
        window["last_part"] = last_part[0];

        // Get first, last and yOffset
        var parts = last_part[0].split(",");
        var number_re = /0[xX][0-9a-fA-F]+|[0-9]+/gi;
        window["first"] = parts[2].match(number_re)[0];
        window["last"] = parts[3].match(number_re)[0];
        window["yAdvance"] = parts[4].match(number_re)[0];

        data = data.replace(last_part[0], '');
        data = data.replace(/\{/gi, '[').replace(/\}/gi, ']');
        data = data.replace('const GFXglyph ', '').replace('const uint8_t ', '').replace(/\[\]\ PROGMEM/gi, '');

        eval(data);

        /*
        // Tada ðŸŽ‰
        console.log(window["name"]);
        console.log(window["size"]);
        console.log(window["first"]);
        console.log(window["last"]);
        console.log(window["last_part"]);
        console.log(window[name + "Bitmaps"]);
        console.log(window[name + "Glyphs"]);
        */

        $('.fontname').text(window["name"] + " â€” " + window["size"] + "pt").show();
        
        // Space from the baseline to the top of the character cell is determined by the character with the
        // largest negative yOffset.
        var maxBaseline = 0;

        // Display tables
        for (ind in window[name + "Glyphs"]) {
            // for each glyph
            var char = String.fromCharCode(parseInt(window["first"], 16) + parseInt(ind));
            var w = window[name + "Glyphs"][ind][1];
            var h = window[name + "Glyphs"][ind][2];
            var adv = window[name + "Glyphs"][ind][3];
            var ow = window[name + "Glyphs"][ind][4];
            var oh = window[name + "Glyphs"][ind][5];
            var n = "";
            
            maxBaseline = Math.max(maxBaseline, -oh);

            // extract numbers
            currentOffset = window[name + "Glyphs"][parseInt(ind)][0];
            if (parseInt(ind) + 1 < window[name + "Glyphs"].length) {
                nextOffset = window[name + "Glyphs"][parseInt(ind)+1][0];
            } else {
                nextOffset = window[name + "Bitmaps"].length;
            }
            for (var k = 0; k < (nextOffset - currentOffset); k++) {
                n += ("000000000" + window[name + "Bitmaps"][currentOffset + k].toString(2)).substr(-8);
            }

            var table = $('<table cellspacing="1"></table>')
                        .addClass('glyph')
                        .attr('data-pixels', n)
                        .attr('data-w', w)
                        .attr('data-h', h)
                        .attr('data-char', char)
                        .attr('data-adv', adv)
                        .attr('data-ow', ow)
                        .attr('data-oh', oh);

            if (window['size'] <= 10) {
                column_w = "two";
            } else if (window['size'] <= 18) {
                column_w = "four";
            } else {
                column_w = "six";
            }

            var grid = $('<div class="' + column_w + ' wide column"></div>');
            var div = $('<div class="ui attached segment inner"></div>');

            div.append(table);
            div.append('<div class="baseline"></div>');

            if (char == " ") {
                grid.append('<h2 class="ui top attached segment inner"><small><em>space</em></small></h2>');
            } else {
                grid.append('<h2 class="ui top attached segment inner">' + char + '</h2>');
            }

            grid.append('<div class="ui attached segment inner secondary">' + "0x" + (parseInt(window["first"], 16) + parseInt(ind)).toString(16).toUpperCase() + '</div>');
            grid.append(div);
             
            var buttonBar = $('<div class="ui bottom attached warning message inner"></div>');
            buttonBar.append(makeUpDownButton("Rows", "row", "purple", 50));
            buttonBar.append(makeUpDownButton("Cols", "col", "violet", 50));
            buttonBar.append(makeUpDownButton("Base", "base", "green", 50));
            buttonBar.append(makeUpDownButton("XOff", "xoff", "blue", 50));
            buttonBar.append(makeUpDownButton("XAdv", "xadv", "teal", 50));
            
            grid.append(buttonBar);

            $('#glyphs').append(grid);
        }
        
        window["maxBaseline"] = maxBaseline;
		
	    $('#glyphs').children().each(function() {
        	setGlyphTable($(this).children().find('.glyph'));
		});
    });

    $(document).on('click', ".cell", function(e) {
        $(e.target).toggleClass('fill');
      	var table = $(e.target).parent().parent().parent().find('table.glyph');
		updatePixels(table, -1, -1);
    });

    $(document).on('click', ".row-handler", function(e) {
      	var targetID = $(e.target).attr("id");
      	var table = $(e.target).parent().parent().parent().find('table.glyph');
		var height = parseInt(table.attr('data-h'));
      
      	if (targetID == "row-add") {
			height++
      	} else if (targetID == "row-remove") {
			height--;
		}
		
		updatePixels(table, -1, height);
        table.attr('data-h', height);
        setGlyphTable(table);
      	return false;
    });

    $(document).on('click', ".col-handler", function(e) {
        var targetID = $(e.target).attr("id");
        var table = $(e.target).parent().parent().parent().find('table.glyph');
		var width = parseInt(table.attr('data-w'));
 
        if (targetID == "col-add") {
            width++;
        } else if (targetID == "col-remove") {
            width--;
        }

		updatePixels(table, width, -1);
        table.attr('data-w', width);
        setGlyphTable(table);
        return false;
    });

    $(document).on('click', ".base-handler", function(e) {
        var targetID = $(e.target).attr("id");
        var table = $(e.target).parent().parent().parent().find('table.glyph');
        if (targetID == "base-add") {
          table.attr('data-oh', parseInt(table.attr('data-oh')) + 1);
        } else if (targetID == "base-remove") {
          table.attr('data-oh', parseInt(table.attr('data-oh')) - 1);
        }

        setGlyphTable(table);
        return false;
    });

    $(document).on('click', ".xadv-handler", function(e) {
		var targetID = $(e.target).attr("id");
		var table = $(e.target).parent().parent().parent().find('table.glyph');
		if (targetID == "xadv-add") {
			table.attr('data-adv', parseInt(table.attr('data-adv')) + 1);
		} else if (targetID == "xadv-remove") {
			table.attr('data-adv', parseInt(table.attr('data-adv')) - 1);
		}

        setGlyphTable(table);
        return false;
    });

    $(document).on('click', ".xoff-handler", function(e) {
        var targetID = $(e.target).attr("id");
        var table = $(e.target).parent().parent().parent().find('table.glyph');
        if (targetID == "xoff-add") {
          	table.attr('data-ow', parseInt(table.attr('data-ow')) + 1);
        } else if (targetID == "xoff-remove") {
          	table.attr('data-ow', parseInt(table.attr('data-ow')) - 1);
        }

        setGlyphTable(table);
        return false;
    });

    $('#export').click(function() {

        var glyphs = [];
        var bitsArray = [];
        var offset = 0;
		var isFirstCharacter = true;

        $("table.glyph").each(function() {
            var t = $(this);
            bits = "";

            $(this).find("td").each(function() {
                var e = $(this);
				if (!e.hasClass('dead')) {
                	var ON = e.hasClass('fill')?"1":"0";
                	bits += ON;

                	// Each 8 bits, we form the HEX value
                	if (bits.length == 8) {
                    	bitsArray.push("0x" + ("00" + parseInt((bits + "00000000").slice(0, 8), 2).toString(16).toUpperCase()).slice(-2));
                    	bits = "";
                	}
				}
            });

            // Remaining bits with padding then, if necessary
            if (bits != "") {
                bitsArray.push("0x" + ("00" + parseInt((bits + "00000000").slice(0, 8), 2).toString(16).toUpperCase()).slice(-2));
            }

            var isLastCharacter = Math.ceil(parseInt(t.attr('data-w')) * parseInt(t.attr('data-h'))/8) + offset < window[name + "Bitmaps"].length;

            glyphs.push(
                " " + (isFirstCharacter ? " " : ",") + "{ " +
                ("     " + offset).slice(-5) + ", " +
                ("   " + parseInt(t.attr('data-w'))).slice(-3) + ", " +
                ("   " + parseInt(t.attr('data-h'))).slice(-3) + ", " +
                ("   " + parseInt(t.attr('data-adv'))).slice(-3) + ", " +
                ("    " + parseInt(t.attr('data-ow'))).slice(-4) + ", " +
                ("    " + parseInt(t.attr('data-oh'))).slice(-4) + " }   " +
                "// '" + t.attr('data-char') + "'");

            offset = bitsArray.length;
			isFirstCharacter = false
        });

        // Bitmaps
        var bitmapsOutput = "const uint8_t " + name + "Bitmaps[] PROGMEM = {\n";
        // We want to join per 12 words
        var limit = Math.floor(bitsArray.length / 12);
        for (nb = 0; nb < limit; nb++) {

            var isLastLine = (limit*12 == bitsArray.length) && (nb == limit -1);

            bitmapsOutput += "  " + bitsArray[nb*12] + ", "
                                  + bitsArray[nb*12+1] + ", "
                                  + bitsArray[nb*12+2] + ", "
                                  + bitsArray[nb*12+3] + ", "
                                  + bitsArray[nb*12+4] + ", "
                                  + bitsArray[nb*12+5] + ", "
                                  + bitsArray[nb*12+6] + ", "
                                  + bitsArray[nb*12+7] + ", "
                                  + bitsArray[nb*12+8] + ", "
                                  + bitsArray[nb*12+9] + ", "
                                  + bitsArray[nb*12+10] + ", "
                                  + bitsArray[nb*12+11] + (isLastLine?"":",") + " \n";
        }
        if (limit*12 != bitsArray.length) {
            bitmapsOutput += "  " + bitsArray.slice(-(bitsArray.length - limit*12)).join(", ") + "\n";
        }
        bitmapsOutput += "};\n\n";

        // Glyphs
        var glyphsOutput = "const GFXglyph " + name + "Glyphs[] PROGMEM = {\n";
        glyphsOutput += glyphs.join('\n') + "\n};\n\n";

        data = bitmapsOutput + glyphsOutput + window["last_part"];
        $("#result").val(data);

    });
});

</script>
</html>